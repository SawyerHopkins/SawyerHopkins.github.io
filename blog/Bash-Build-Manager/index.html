<!DOCTYPE HTML>
<!--
	Prologue 1.1 by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="icon" href="/favicon.ico">

	<title>Bash Build Manager</title>
	
<!-- Google Analytics -->
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54925912-1', 'auto');
  ga('send', 'pageview');

	</script>
	
<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
	
<!-- Latest compiled and minified JavaScript -->
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	
<!-- FontAwesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
	<script src="/assets/js/ie-emulation-modes-warning.js"></script>

	<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
 <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Custom styles for this template -->
	<link href="/assets/css/carousel.css" rel="stylesheet">
	<link href="/assets/css/catagories.css" rel="stylesheet">
	<link href="/assets/css/general.css" rel="stylesheet">
	<link href="/assets/css/gist.css" rel="stylesheet">
	<link href="/assets/css/feature.css" rel="stylesheet">
	<link href="/assets/css/navbar.css" rel="stylesheet">
	<link href="/assets/css/post.css" rel="stylesheet">
	<link href="/assets/css/page.css" rel="stylesheet">
	<link href="/assets/css/pagination.css" rel="stylesheet">
	<link href="/assets/css/social.css" rel="stylesheet">
	<link href="/assets/css/syntax.css" rel="stylesheet">
	<link href="/assets/css/wells.css" rel="stylesheet">
 </head>
	<body>
		<!-- NAVBAR
================================================== -->
<body>
	<div class="navbar-wrapper">
		<div class="container">		
			<div class="navbar navbar-inverse navbar-static-top" role="navigation">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="/">
						<img class="img-grav" src="/assets/img/profile.jpg" alt="A picture of me.">  
						Sawyer Hopkins </a>
					</div>
					<div class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							
								<li><a href="/">Home</a></li>
								<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown"> Blog <span class="caret"></span></a>
								<ul class="dropdown-menu" role="menu">
									<li><a href="/blog/">Recent</a></li>
									<li class="divider"></li>
									<li><a href="/categories/">Categories</a></li>
								</ul>
								</li>
							
						</ul>
						<ul class="nav navbar-nav iconnav">
							<li class="icon-row"><a href="https://www.facebook.com/sshopkin" class="icon-link"><i class="fa fa-facebook-square social"></i></a></li>
							<li class="icon-row"><a href="https://www.linkedin.com/in/sawyerhopkins" class="icon-link"><i class="fa fa-linkedin-square social"></i></a></li>
							<li class="icon-row"><a href="https://github.com/SawyerHopkins" class="icon-link"><i class="fa fa-github-square social"></i></a></li>
							<li class="icon-row"><a href="mailto:sawyer@sawyerhopkins.com" class="icon-link"><i class="fa fa-envelope-square social"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
		    <!-- Carousel
    ================================================== -->
    <div id="myCarousel" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner" role="listbox" style="background: url(/assets/img/sawyerheader.jpg) no-repeat top center fixed">
	  	
		<div class="item active">		
		

          <!--<img src="/assets/img/sawyerheader.png" class="img-responsive">-->
          <div class="container">
            <div class="carousel-caption">
              <h1><b><span class="carousel-text">Bash Build Manager</span></b></h1>
              <p><span class="carousel-text">Using bash to manage build chains.</span></p>
            </div>
          </div>
        </div>		
		
	</div>	
    </div><!-- /.carousel -->
		<!-- Main -->
		<div id="main">
			<div class="well well-depth-1 post-body">
				<div class="post-block">
			    	<div class="well well-depth-2">
			    	<p class="post-header">Managing A Build Chain</p>

<p class="post-para">Working on ProteinSim I wanted a quick way to both compile the entire project for the desired build configuration, and also be able to quickly remove or add sub-projects from the chain. So I came up with an approach to use sed to automate this process.</p>

<!--more-->	

<p class="post-header">Build Template</p>

<p class="post-para">I created a <i>.automation</i> folder to hide away this, and any future automation templates, to keep my working directory clean. ProteinSim is structured into three sub-projects: the core library, the forces, and the user interface. I created the template below using bash comments to identify these three areas.</p>

<figure>
<figcaption><b>buildAll.template</b></figcaption>
<div class="post-para">
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno"> 1</span> <span class="c">#CORE</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="nb">echo</span>
<span class="lineno"> 4</span> <span class="nb">echo </span>Making core library
<span class="lineno"> 5</span> <span class="nb">echo</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="nb">cd </span>ClusteredCore/<span class="nv">$1</span>
<span class="lineno"> 8</span> make
<span class="lineno"> 9</span> <span class="nb">cd</span> ../../
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="c">#END</span>
<span class="lineno">12</span> <span class="c">#FORCE</span>
<span class="lineno">13</span> 
<span class="lineno">14</span> <span class="nb">echo</span>
<span class="lineno">15</span> <span class="nb">echo </span>Making %NAME%
<span class="lineno">16</span> <span class="nb">echo</span>
<span class="lineno">17</span> 
<span class="lineno">18</span> <span class="nb">cd</span> %NAME%/<span class="nv">$1</span>
<span class="lineno">19</span> make
<span class="lineno">20</span> <span class="nb">cd</span> ../../
<span class="lineno">21</span> 
<span class="lineno">22</span> <span class="c">#END</span>
<span class="lineno">23</span> <span class="c">#UI</span>
<span class="lineno">24</span> 
<span class="lineno">25</span> <span class="nb">echo</span>
<span class="lineno">26</span> <span class="nb">echo </span>Making user interface
<span class="lineno">27</span> <span class="nb">echo</span>
<span class="lineno">28</span> 
<span class="lineno">29</span> <span class="nb">cd </span>ClusteredUI/<span class="nv">$1</span>
<span class="lineno">30</span> make
<span class="lineno">31</span> make post-build
<span class="lineno">32</span> <span class="nb">cd</span> ../../
<span class="lineno">33</span> 
<span class="lineno">34</span> <span class="c">#END</span></code></pre></div>
</div>
</figure>

<p class="post-para">Since there are several different forces I have not named them explicitly in the template, but created a placeholder, <i>%NAME%</i>, to be filled in by the automation process. This template also indicates that the final script will take one argument (hence the <i>$1</i>), which will be used to identify which build configuration to use. My build configurations are in self contained folders so moving to that folder and running <i>make</i> is sufficent.</p>

<p class="post-header">Parsing the Template</p>

<p class="post-para">To put this all together I will need a list of forces to replace the placeholder that I created in the template. Since I do not want to remember all the force names and type them all out every time I want to update the chain, I will store them in a file hidden in the <i>.automation</i> folder. For convenience I will also manage this file with the automation script.</p>

<figure>
<figcaption><b>buildAll.template</b></figcaption>
<div class="post-para">
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="lineno"> 1</span> <span class="c">#!/bin/bash</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">function</span> add <span class="o">{</span>
<span class="lineno"> 4</span>     <span class="nb">echo</span> <span class="s2">&quot;$1&quot;</span> &gt;&gt; .automation/forceList
<span class="lineno"> 5</span> <span class="o">}</span>
<span class="lineno"> 6</span> <span class="k">function</span> remove <span class="o">{</span>
<span class="lineno"> 7</span>     sed -i <span class="s2">&quot;/$1/d&quot;</span> .automation/forceList
<span class="lineno"> 8</span> <span class="o">}</span>
<span class="lineno"> 9</span> <span class="k">function</span> build <span class="o">{</span>
<span class="lineno">10</span>     readarray -t forces &lt; .automation/forceList
<span class="lineno">11</span>     <span class="c">#Write the core complier from template</span>
<span class="lineno">12</span>     sed -n -e <span class="s2">&quot;/#CORE/,/#END/w buildAll.sh&quot;</span> .automation/buildAll.template
<span class="lineno">13</span>     <span class="c">#Write the force compilers from template</span>
<span class="lineno">14</span>     <span class="k">for</span> var in <span class="s2">&quot;${forces[@]}&quot;</span>
<span class="lineno">15</span>     <span class="k">do</span>
<span class="lineno">16</span> 	<span class="nb">echo</span> <span class="s2">&quot;Writing ${var}&quot;</span>
<span class="lineno">17</span>         <span class="nb">echo</span> <span class="s2">&quot;$(sed -n &#39;/#FORCE/,/#END/p&#39; .automation/buildAll.template)&quot;</span> &gt;&gt; buildAll.sh
<span class="lineno">18</span>         sed -i -e <span class="s2">&quot;s;%NAME%;${var};g&quot;</span> buildAll.sh 
<span class="lineno">19</span>     <span class="k">done</span>
<span class="lineno">20</span>     <span class="c">#Write the UI compile from template</span>
<span class="lineno">21</span>     <span class="nb">echo</span> <span class="s2">&quot;$(sed -n &#39;/#UI/,/#END/p&#39; .automation/buildAll.template)&quot;</span> &gt;&gt; buildAll.sh
<span class="lineno">22</span> <span class="o">}</span>
<span class="lineno">23</span> <span class="k">function</span> display <span class="o">{</span>
<span class="lineno">24</span>     <span class="nb">echo</span>
<span class="lineno">25</span> <span class="nb">    </span>cat &lt; .automation/forceList
<span class="lineno">26</span>     <span class="nb">echo</span>
<span class="lineno">27</span> <span class="o">}</span>
<span class="lineno">28</span> 
<span class="lineno">29</span> <span class="k">while</span> <span class="nb">getopts</span> <span class="s2">&quot;a:r:bc&quot;</span> OPTION
<span class="lineno">30</span> <span class="k">do</span>
<span class="lineno">31</span>     <span class="k">case</span> <span class="nv">$OPTION</span> in
<span class="lineno">32</span>         a<span class="o">)</span>
<span class="lineno">33</span>             add <span class="nv">$OPTARG</span>
<span class="lineno">34</span>             <span class="p">;;</span>
<span class="lineno">35</span>         r<span class="o">)</span>
<span class="lineno">36</span>             remove <span class="nv">$OPTARG</span>
<span class="lineno">37</span>             <span class="p">;;</span>
<span class="lineno">38</span>         b<span class="o">)</span>
<span class="lineno">39</span>             build
<span class="lineno">40</span>             <span class="p">;;</span>
<span class="lineno">41</span>         c<span class="o">)</span>
<span class="lineno">42</span>             display
<span class="lineno">43</span>             <span class="p">;;</span>
<span class="lineno">44</span>     <span class="k">esac</span>
<span class="lineno">45</span> <span class="k">done</span></code></pre></div>
</div>
</figure>

<p class="post-para">So the script above takes four possible inputs, three to manage the force list and one to put everything together. The add (<i>-a</i>) option takes a force name as an input and appends it to <i>forceList</i>. The remove (<i>-r</i>) option also takes a name as an input, but instead uses sed to remove that line from the file. Then the display command (<i>-c</i>) just pushes the contents to the console.</p>

<p class="post-para">In the build function I initially use sed on line 12 to write a new file containing everything from <i>#CORE</i> to <i>#END</i> in the template file. I then iterate over all the names in the <i>forceList</i> file and on line 17 use sed as a variable for <i>echo</i> to append to the build chain. This is double quoted so that the carriage returns are retained. I then use sed again to replace the placeholder with the force name.</p>
			    	</div>
					<div class="gist-link">
					
						<div class="well well-depth-2">
						<b>Like this jist? <a href="/gists/Bash-Build-Manager">Get the Gist</a>.</b>
						</div>
					  
					</div>

				<div class="social-sharing">
	
	<div class="share-button text">
	Share
	</div>
	<div class="share-button twitter">
		<a href="https://twitter.com/home?status=/blog/Bash-Build-Manager " target="_blank"><i class="fa fa-twitter social"></i></a>
	</div>
	<div class="share-button linkedin">
		<a href="http://www.linkedin.com/shareArticle?mini=true&url=/blog/Bash-Build-Manager&title=Bash Build Manager&summary=Using bash to manage build chains.&source=SawyerHopkins.com" target="_blank"><i class="fa fa-linkedin social"></i></a>
	</div>
	<div class="share-button gplus">
		<a href="https://plus.google.com/share?url=/blog/Bash-Build-Manager" target="_blank"><i class="fa fa-google-plus social"></i></a>
	</div>
	
</div>
				  
				
					<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sawyerhopkins'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
     
				
				</div>
			</div>
		</div>
		
	</body>
</html>